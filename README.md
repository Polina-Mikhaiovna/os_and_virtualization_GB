# Операционные системы и виртуализация

## Установка гостевой ОС, настройка для работы через SSH-Server

### Для начала необходимо разрешить в настройках BIOSa виртуализацию. 


### После установки Ubuntu Server или Desktop 22.04 через VirtualBox, запускаем гостевую ОС.


Устанавливаем Midnight Commander Это многофункциональное полноэкранное текстовое приложение, которое позволяет копировать, перемещать и удалять файлы и целые деревья каталогов, искать файлы и запускать команды в подоболочке. Так же включает в себя текстовый просмотрщик и редактор.

Предполагаю чтобы удаленно подключиться к каталогам машины из сети, используя FTP-соединение.


### Установить SSH-соединение с виртуальной машиной из хостовой.

В гостевой ОС:

- *sudo apt installl openssh-server*

- проверить статус службы SSH с помощью systemctl *systemctl status ssh*

- команда *sudo ss -ntlp* позволяет с помощью утилиты ss перечислить открытые TCP-порты

- узнать адрес *ip a* для дальнейшего подключения из хостовой

В хостовой ОС:

- подключаемся через ssh к запущенной гостевой ОС указывая имя и ip-адрес *ssh oldfathw_gb@192.168.0.103*


## Команды для работы с файлами и ссылками

- *cat > fileName* /n и после переноса строки вводить содержимое файла

- cat >> filename /n и после переноса дописать в файл

- cp fileSource fileDestination, с флагом -r (рекурсивно) будут скопированы и вложенные файлы

### Жёсткие ссылки 

Работают через inode - индексный дескриптор,  который храник всю информацию о файле кроме его имени и непосредственно данных. Жёсткие ссылки можно создавать только в рамках одной файловой системы. Посмотреть сколько фаайловых систем есть - *df -h*

- можно создать жесткую ссылку на файл *ln file file1*

- посмотрев статус жестких ссылок используя влаг -i (*ls -lai*) будут видны 2 файла - file и file1 с двойкой в счётчике жестких ссылок на  inode

### Символические ссылки

- ln -s  /home/username/fileSourse fileLink можно указать ссылку на любую файловую систему

### Пейджеры less more

- *less filename* внутри пейджера  */искомый текст*

- *tail filename* выводит 10 последних строк

- *tail -n 5*

- *tail -f* - видеть изменения в режиме реальног времени (последние 10 строк) 

## Права доступа и пользователи

### Классификация пользователей

- **Суперпользователь** root. Есть права доступа ко всему UID = 0, есть Shell, домашняя директоирия /root, может не быть пароля, это запрещает подключение через SSH через этого пользователя, и залогиниться в консоли 

- **Обычный пользователь** user. 

- **Системный пользователь** daemon. Создаётся для работы программ, сервисов которые работают в фоне, так как программы должны быть прикреплены к какому-то пользователью. Его права максимально ограничены.

- Информация о пользователях в файле /ets/passwd в формате логин:заглушка пароля(x):UID:GID:полное имя:пуль к оболочке

- О группах пользователей /ets/group

- о паролях и их свойствах /ets/shadow

- Создание изменение пользователей useradd, adduser, usermod, userdel

Ex.: sudo useradd -s /bin/bash -m -d /home/newUser newUser

                  |             |  |                  |

            флаг для установки  |  её путь          логин

                оболочки        |

                            создать

                       домашнюю директорию



- Задать пароль *sudo passwd username*

- *passwd* - смена пароля текущего пользователя

Можно проверить были ли изменения паролей открыв *sudo tail /etc/shadow

- Для настройки параметров паролей (срок действия, срок ротации и т.д.) необходима
утилита chage.

- Для просмотра текущих настроек пароля параметр -l: *sudo chage -l testuser*


Есть скелет - набор файлов который копируется из /etc/skel при создании нового юзера скриптом adduser

- Добавить пользователя в дополнительную группу  *sudo usermod -aG(append в дополнительные группы) adm(название группы) username*

-  смена основной группы *sudo usermod -g www-data(название группы) username*

- Проверка в id пользователя и его групп - *sudo id username*


## Механизм sudo и su

- *su* - переключение пользователя, например,  *su testuser* откроет оболочку другого пользователя, для выходна понадобится *exit*

- *sudo su* - переключение на суперпользователя (root)

- *sudo* - выполнение кроманды с правами суперпользователя

- /ets/sudoers - конфигурация sudo (сюда не писать ручками - ОПАСНО)

- *visudo* - редактирование конфигурации

## Права доступа для файлов и каталогов

В формате прав доступа *-rwxr-xr--* первые 3 бита (после -) это права владельца, вторые 3 бита права группы, третьи - все остальные пользователи.
Каждая из троек имеет 3 бита, они могу быть заполнены - rwx (read, wreate, execute), либо прочерк - значит такого права нет. 

### Изменение владельца и группы владельца файлов

- chown - изменение владельца и группы
* chown -R ОПАСНО, надо внимательно прописывать абсолютный путь и проверять группу
* chown testuser:testgroup
* chown testuser

- chgrp - изменение группы
* chgrp -R рекурсивно
* chgrp testgroup

Права доступа можно представить в численном виде, используя восьмеричную
систему счисления:

0 – нет битов;

1 – x;

2 – w;

3 – wx;

4 – r;

5 – rx;

6 – rw;

7 – rwx.

Изменение прав доступа chmod (change mode).
Для назначения прав доступа можно использовать как текстовые и цифровые обозначения.

- *chmod u=rwx,g+w,o-r testle*

В этом примере мы назначили права rwx для владельца – u, добавили право на запись для группы и убрали право на чтение для остальных. Таким образом, у нас есть несколько типов субъектов прав:

u (user) – владелец;

g (group) – группа;

o (others) – остальные;

a (all) – все.

Однако, если мы знаем точную формулу, гораздо быстрее назначить права в цифровом виде:

- chmod -R 755 testdir/ - назначили права rwxr-xr-x рекурсивно для всех вложенных элементов и самой директории.

Менять права доступа может либо владелец файла, либо суперпользователь root.


## Специальные биты доступа SUID, SGID, sticky bit

### SUID (set user ID upon execution) - разрешает пользователям запускать файл на исполнение с правами того пользователя, которому принадлежит данный файл 

- в символьной записи *chmod u+s file* 
- в численной записи имеет значение 4000 - *chmod 4755 file* 

### SGID (set user ID upon execution)

- Если установить SGID для каталога, то все файлы созданные в нем при запуске будут принимать идентификатор группы каталога, а не группы владельца, который создал файл в этом каталоге.

### Sticky bit

Файлы из каталога с таким битом может удалить только владелец (создавший этот файл) или владелец каталога.

- В символьной записи *chmod +t dir* добавит к каталогу sticky bit, что позволит удалять файлы в этой директории только её владельцу

- В численной записи имеет значение 1000, например *chmod 1666 dir1* установит на каталог права на чтение-запись-просмотр для всех типов пользователей, но при этом удалять файлы могут только создатели благодаря установленному биту sticky.

## Права по умолчанию и umask

Значение umask (ex.: 0022) относится к битам доступа, которые будут вычитаться из набора полных прав по умолчанию: 666 для файлов и 777 для директорий.
